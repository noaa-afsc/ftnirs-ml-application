<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using the Application – ftnirs-ml-application Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../content/useCodebase.html" rel="next">
<link href="../content/Use.html" rel="prev">
<link href="../images/fishy.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5909a3536145e1507e3897035ea997a2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-8f4cbf19915c7ede4ee9758edf4cc63c.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/Use.html">Use</a></li><li class="breadcrumb-item"><a href="../content/useApp.html">The app</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/79/NOAA_logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/DanWoodrichNOAA/ftnirs-mlapp" title="application repository" class="quarto-navigation-tool px-1" aria-label="application repository"><i class="bi bi-app"></i></a>
    <a href="https://github.com/DanWoodrichNOAA/ftnirs-ml-codebase" title="codebase repository" class="quarto-navigation-tool px-1" aria-label="codebase repository"><i class="bi bi-cpu"></i></a>
    <a href="https://github.com/noaa-afsc/ftnirs-ml-application" title="Site repository" class="quarto-navigation-tool px-1" aria-label="Site repository"><i class="bi bi-globe"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/backScience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The science</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/backDesign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The design</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Use.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/useApp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The app</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/useCodebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The codebase</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/dataPrep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data preparation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/exApp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The app</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/exCodebase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The codebase</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Integrative.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Integrative</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/contScience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evolving scientific techniques</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/contApp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/contDocumentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The documentation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Maintaining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maintaining</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/maintApp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">App data and models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/selfHost.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self-hosting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/futDirections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Future Directions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FAQ</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://10.27.25.171/ftnirs_mlapp/"><img src="images/fishy.jpg" class="img-fluid figure-img" style="width:100.0%" alt="NOAA internal app link"></a></p>
<figcaption>NOAA internal app link</figcaption>
</figure>
</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-layout" id="toc-the-layout" class="nav-link active" data-scroll-target="#the-layout">The layout</a></li>
  <li><a href="#inputing-data" id="toc-inputing-data" class="nav-link" data-scroll-target="#inputing-data">Inputing data</a></li>
  <li><a href="#detailed-section-by-section" id="toc-detailed-section-by-section" class="nav-link" data-scroll-target="#detailed-section-by-section">Detailed section by section</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/edit/main/content/useApp.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/blob/main/content/useApp.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/Use.html">Use</a></li><li class="breadcrumb-item"><a href="../content/useApp.html">The app</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Using the Application</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="the-layout" class="level3">
<h3 class="anchored" data-anchor-id="the-layout">The layout</h3>
<details>
<summary>
<font size="4">Preparing to run models</font>
</summary>
<p>The app components are ordered to go left right / top to bottom, usually in the order you would modify them in a typical workflow.</p>
<p>At the very top, we have a few buttons. The first is a link to go to the home page (<strong><em>NOTE TO SELF, may deprecate if move to one page app</em></strong>), a link to the documentation (this website), and in the right we have the git versions and buttons with links to the git repos.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_top_buttons.png" class="img-fluid figure-img"></p>
<figcaption>Navigation</figcaption>
</figure>
</div>
<p>In the top left, we have the data upload / select pane. You can browse through existing datasets in the app or upload further datasets.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_data.png" class="img-fluid figure-img"></p>
<figcaption>Data browsing and upload section of the app</figcaption>
</figure>
</div>
<p>The datasets will do different things depending on which ‘mode’ is selected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_mode.png" class="img-fluid figure-img"></p>
<figcaption>Mode and approach section of the app</figcaption>
</figure>
</div>
<p>To the right, once one or more datasets are selected, options are available in the Data Columns pane. This allows for selection of which columns will be considered in the model run event. Depending on mode and the dataset(s) selected, you will have different options here and your choices will result in different behaviors (see more details in Data Columns section)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_data_columns.png" class="img-fluid figure-img"></p>
<figcaption>Data Columns pane</figcaption>
</figure>
</div>
<p>To the right of that, you have options for parameterization. Within this pane, you can choose parameters for signal processing,</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_signal_processing.png" class="img-fluid figure-img"></p>
<figcaption>Parameters pane: signal processing</figcaption>
</figure>
</div>
<p>parameters specific to the mode,</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_general_train_params.png" class="img-fluid figure-img"></p>
<figcaption>Parameters pane: mode general</figcaption>
</figure>
</div>
<p>and parameters specific to the training/fine-tuning approach.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_approach_specific_train_params.png" class="img-fluid figure-img"></p>
<figcaption>Parameters pane: approach</figcaption>
</figure>
</div>
<p>Once all of these sections have been considered, you can run the particular model event (will vary depending on mode) with the run button.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_run.png" class="img-fluid figure-img"></p>
<figcaption>Run button</figcaption>
</figure>
</div>
</details>
<details>
<summary>
<font size="4">Running models</font>
</summary>
<p>The run button will execute the model run event based on the parameters provided in the aforementioned sections.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_run.png" class="img-fluid figure-img"></p>
<figcaption>Run button</figcaption>
</figure>
</div>
<p>While the model is running, there is an intermediate app stage where you will be provided live information. The run button will display as a loading icon during training. Jobs cannot be canceled once started (<strong><em>NOTE: maybe can change if move to single page app?</em></strong>). To the left of the run button is logging information for the algorithm process.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_in_progress_logs.png" class="img-fluid figure-img"></p>
<figcaption>Event logs</figcaption>
</figure>
</div>
<p>To the right is a live display of the training loss and validation loss, used to assess the appropriate degree of model fitting and help select a resonable training time or early stopping criterion.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_in_progress_graph.png" class="img-fluid figure-img"></p>
<figcaption>Training loss curve</figcaption>
</figure>
</div>
<p>While model training is ongoing, the numner of concurrent tensorflow jobs in the top bar will increment up by one. This is a global value shared between all users currently training models on the server, and exists to help identify if any errors or poor performance could be related to resource contention.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_in_progress_concurrent.png" class="img-fluid figure-img"></p>
<figcaption>Concurrent tensorflow jobs</figcaption>
</figure>
</div>
<p>Any errors observed during model training will be displayed in the bottom left, accompanied by a banner error.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/errors.png" class="img-fluid figure-img"></p>
<figcaption>Errors</figcaption>
</figure>
</div>
</details>
<details>
<summary>
<font size="4">Model results</font>
</summary>
<p>If the model run event has finished without errors, you can scroll down to see outputs relevant to the mode selected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_complete.png" class="img-fluid figure-img"></p>
<figcaption>Completed run</figcaption>
</figure>
</div>
<p>In the center section are stats and graphical artifacts demonstrating model behaviors and performance. Depending on whether truth ages were provided, this will show a truth vs prediction scatterplot, a histogram, or both if age data are partially provided. Color values will indicate splits if in training or fine tuning mode, or dataset name if in inference mode.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_complete_stats.png" class="img-fluid figure-img"></p>
<figcaption>Stats and graphical artifacts</figcaption>
</figure>
</div>
<p>While also mentioned as a live feedback source while running models, the completed training loss curve is available in the top right. Note that all embedded visualizations have built in features such as allowing zooming, hovering points for more precise values, and saving views as an image directly.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_complete_loss_curve.png" class="img-fluid figure-img"></p>
<figcaption>Training loss artifact</figcaption>
</figure>
</div>
<p>On the left are the parameters used for the completed run. There are also two fields where you can add some descriptive information on the run: a name and a description, which are metadata which are attached to exported objects once provided.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_complete_configuration.png" class="img-fluid figure-img"></p>
<figcaption>Model run configuration</figcaption>
</figure>
</div>
<p>On the right are a few options to export model results. The download results button downloads run outputs (model objects, age predictions, metadata, etc), and the upload trianed model (only available after training or fine-tuning) allows for you to upload a model so it is available for subsequent inference or fine-tuning by any lab users. After upload, it will be immediately available for further workflows using that trained model.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/run_complete_outputs.png" class="img-fluid figure-img"></p>
<figcaption>Outputs</figcaption>
</figure>
</div>
</details>
</section>
<section id="inputing-data" class="level3">
<h3 class="anchored" data-anchor-id="inputing-data">Inputing data</h3>
<details>
<summary>
<font size="4">Formatting data</font>
</summary>
<p>First, you will need to identify the data that you’d like to work with. The technique specifically accepts both spectroscopy data along with other per-otolith biological or spatiotemporal contextual data. The codebase and app use a fairy primitive string matching protocol, and they both make assumptions about what certain columns do based on naming, so remember:</p>
<p><strong>What you name columns matters!</strong></p>
<p>All of the naming conventions are defined at the codebase level, within the file <a href="https://github.com/noaa-afsc/ftnirs-ml-codebase/blob/main/ftnirsml/constants.py">“constants”</a> within the ML codebase. Here are some examples of a few of them at the time of writing:</p>
<ul>
<li>IDNAME = “id”</li>
<li>RESPONSENAME = “age”</li>
<li>WN_STRING_NAME = ’wn**’</li>
<li>SPLITNAME = “split”</li>
</ul>
<p>This means that the codebase and application will give columns with these names special treatment, and so when preparing data you will need to be very aware when you need to name your dataset with on of these columns. Here are their definitions:</p>
<ul>
<li><p>id: a unique identifier that should be globally unique to the specific otolith. Keeping the id specific to the identity of the otolith is important, as when many datasets are being used for training there are filters within the app to ensure that incidental duplicate values that lead to dataset contamination and comprimised results are not present The contents are not as important, this could be a path to an image, an integer key, a hash, etc.</p></li>
<li><p>age: this is the response variable, and while it is not necessary to include in every dataset (such as when this is not available and should be predicted with inference in the app), it is needed for model training or fine-tuning. The app will be flexible if the age column is provided but ages are only available for certain rows- for these datasets, mark missing ages as NA.</p></li>
<li><p>wn**: this is the syntax that wav numbers should correspond to. The app will assume any column with characters containing ‘wn’ (<strong><em>note to self, this is a good back end improvement, should just match to start of string</em></strong>) is a wav number column. The numbers should directly follow the ‘wn’ prefix, so a value 8000 would be specified as “wn8000”. Decimal values are ok, ie wn8000.0023. The wav numbers can be in ascending or decending order but must be consecutive (cannot have other biological/spatiotemporal columns interspersed between them), and where they are located in the dataframe does not matter. (<strong><em>note to self: test all these assumptions, reduce if more permissive than remembered</em></strong>)</p></li>
<li><p>split: OPTIONAL: this is defined if you would like to define custom training splits during training. If you do want to define training splits, you must define this columns with the exact categories “training”,“validation”,“test” (you may leave out one or two of these as desired). You can also define this column, and within the app still specify app generated splits as desired.</p></li>
</ul>
<p>In addition to these specific values, there is also a registry of ‘standard variables’, which help combine like data between different groups and also contain information about the type of data which help for how the application treats these data types. Here is an example of how these are defined:</p>
<p>STANDARD_COLUMN_NAMES = {IDNAME:{‘data_type’:‘unq_text’}, SPLITNAME:{‘data_type’:‘int’}, ‘catch_year’ : {‘data_type’:‘int’}, ‘catch_month’: {‘data_type’: ‘int’}, ‘catch_day’: {‘data_type’: ‘int’}, ‘sex’ : {‘data_type’:‘categorical’}, RESPONSENAME : {‘data_type’:‘numeric’}, ‘latitude’ : {‘data_type’:‘numeric’}, ‘longitude’ : {‘data_type’:‘numeric’}, ‘region’: {‘data_type’: ‘categorical’}, ‘fish_length’: {‘data_type’: ‘numeric’}, ‘fish_weight’: {‘data_type’: ‘numeric’}, ‘otolith_weight’: {‘data_type’: ‘numeric’}, ‘gear_depth’: {‘data_type’: ‘numeric’}, ‘gear_temp’: {‘data_type’: ‘numeric’} }</p>
<p>In the above, declaring categorical variables will allow for instance the application to automatically apply one-hot encoding to these variables. (<strong><em>note to self, this is a good back end improvement, define UNITS in this structure</em></strong>)</p>
<p>***NOTE: there is also a sneaky/unexpected behavior to watch out for. The codebase relies on a simple string match to determine whether a column represents a ‘one-hot-encoded’ column once the one hot encoded categorical column has been expanded into multiple columns. This is essential a reserved sequence of characters, that if they conflict with column names may result in adverse behaviors. The reserved sequence of characters is defined in the [“constants”] file (https://github.com/noaa-afsc/ftnirs-ml-codebase/blob/main/ftnirsml/constants.py) within the ML codebase, as ONE_HOT_FLAG. This should be kept static while data are in training cycles to allow for consistency of how these one-hot-encoded columns are treated.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/standard_columns.png" class="img-fluid figure-img"></p>
<figcaption>Application interpretation of a dataset based on names of columns in dataset</figcaption>
</figure>
</div>
<p>For some examples of properly formatted data, you can refer to sample <a href="https://github.com/noaa-afsc/ftnirs-ml-codebase/tree/main/tests/Data">datasets</a> in the tests folder of the ML codebase.</p>
</details>
<details>
<summary>
<font size="4">How and if to split up data</font>
</summary>
<p>There are two different different philosophies to provide data to the app. One is with larger, expansive datasets meant to cover large portions of your dataset. These should be named and curated for keeping in the app for continuous reuse and shared use.</p>
<p>Additionaly, you can split up datasets for more specific experiments involving varying along spatiotemporal groupings. While the app will allow you to aggregate data for processing in common, it does not contain features to split up larger datasets into smaller components (it does, however, allow you to select which columns you’d like to consider in a given model run event). If you are doing a yearly model inference/update workflow, you may choose to load data in different temporally bounded datasets (data_2016.csv, data_2017.csv, etc) which will allow for fine grain control of which to include or leave out. If you are interested in performing experiments over geospatial differences (data_GoA.csv, data_Ber.csv) this is another way you can split up data.</p>
<p>The app will flag and reject if there are multiple datasets that contain and equal id, to avoid dataset contaminiation issues during training that will comprimise results. It will do this at time of model training, meaning that datasets splitting up the same data in different ways can go into the application simultaneously. With many different possible ways to split up and organize data prior to the app, datasets of this style are best managed for short term use, and will need to get cleared out periodically by site admins to keep the number of total datasets to resonable levels in the dropdowns (***NOTE to self: this is a good QoL feature: temporary datasets.).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/id_nonunique.png" class="img-fluid figure-img"></p>
<figcaption>Application error for non-unique IDs</figcaption>
</figure>
</div>
</details>
<details>
<summary>
<font size="4">Loading datasets into the application </font>
</summary>
<p>To upload data into the app, use the upload button in the top left.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_data_zoom.png" class="img-fluid figure-img"></p>
<figcaption>Data browsing and upload section of the app</figcaption>
</figure>
</div>
</details>
</section>
<section id="detailed-section-by-section" class="level3">
<h3 class="anchored" data-anchor-id="detailed-section-by-section">Detailed section by section</h3>
<details>
<summary>
<font size="4">Select Datasets </font>
</summary>
<p>This section allows you to select from previously uploaded data and upload new datasets. Any .csv file will be accepted, and the app will attempt to use certain columns based on exact matches to naming convention. Depending on the mode, the purpose of the dataset will be variable. For most downstream operations, datasets are used as a vertically concatenated (think ‘rbind’ in R) combination of all the selected datasets. Output data will use names and unique hashes of these component datasets for record keeping and more detailed breadowns outside of the app.</p>
<p>See next section for how these selected datasets are used for the different modes.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_data_zoom.png" class="img-fluid figure-img"></p>
<figcaption>Data browsing and upload section of the app</figcaption>
</figure>
</div>
</details>
<details>
<summary>
<font size="4">Select Mode</font>
</summary>
<p>ML models that fit the application native format can be directly uploaded. See examples of use of the ML codebase, including the case where you convert an existing model into the compatible application model format. For inputting models generated through the application, simply path to the output .keras.zip file downloaded from a previous training event.</p>
<p>The datasets you have selected will function differently depending on what mode you select:</p>
<ul>
<li>If ‘training’ is selected, the selected dataset(s) will function as training data.</li>
<li>If ‘inference’ is selected, the selected dataset(s) will function as data upon which inference is applied (output statistics will use existance of ‘age’ if available, otherwise will report histogram of output ages)</li>
<li>If ‘fine-tuning’ is selected, the selected dataset(s) will function as data for which the model is fine tuned on.</li>
</ul>
<details>
<summary>
Training Mode
</summary>
<p>The training mode is used when a new model is being trained using a combination of user selected training data (indicated in the data selection pan in the top left) and a given techinique (“approach”). The “basic model” approach is a simple and minimal archetecture that is customizable in parameters and is trained in a single training event. The hyperband algorithm is a more sophisticated orchestration technique where model archecture is ‘tuned’ to optimize performance over a sequence of optimization rounds.</p>
<p>These approaches are defined in the ML codebase, and must be encorporated into the application code itself. The application code has been designed so addition of additional approaches is straightforward.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_data.png" class="img-fluid figure-img"></p>
<figcaption>An example of two different available approaches in the training mode</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Inference mode
</summary>
<p>The inference mode is used when a previously trained model exists, and you wish to apply it to a different dataset. The inference mode will take this chosen model and attempt, if compatible, to apply it to the user selected training data (indicated in the data selection pan in the top left). Note that the application will aggressively attempt to make datasets compatible, so pay attention to any information provided in the model metadata as well as in the data pane. Datasets run for inference can include the response column. If the response column is provided, R2 scores will be provided, if not, a histogram of ages with be provided, and if ages are partially known, both will be provided.</p>
<p>When a trained model is selected, the app will display any available metadata. This can help assess compatibility with different datasets. This also includes metadata on any description given to the model (good practice is to discuss the training data used), as well as other information relevant for fine-tuning.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_mode_inference.png" class="img-fluid figure-img"></p>
<figcaption>Model metadata, inference</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Fine-tuning mode
</summary>
<p>The fine-tuning mode is used when a previously trained model exists, and you wish to retain some information from the previous weights while ‘fine-tuning’ it on another dataset. This is an operation that takes some nuance, especially considering the shallow depth of most of these models which make it very easy to discard existing weights if number of training epochs and learning rate (<strong><em>NOTE to self: is this even in here? Add??</em></strong>) is not chosen carefully.</p>
<p>The model metadata contains information relevant for fine-tuning, including the max_bio_columns, which is relevant for fine-tuning as it represents the total amount of non-wavenumber columns supported by the model archetecture for further fine-tuning. If the number of non-wavenumber columns exceeds this value, further retraining will not be possible.</p>
</details>
</details>
<details>
<summary>
<font size="4">Data Columns</font>
</summary>
<p>The data columns pane is responsive to both:</p>
<ul>
<li>The column names in the selected datsets, and</li>
<li>The mode selected</li>
</ul>
<p>The data pane will display the following information:</p>
<ol type="1">
<li>Whether a given data column is selectable (optional) for the particular mode. Columns that are not selectable will generally say why.<br>
</li>
<li>Wav numbers and spectrography attributes for each different dataset, as well as if they are ‘valid’ (fit the criteria for wn** columns and are formatted correctly), and equivalent (how many match the same spectroscopy settings)</li>
<li>Whether columns match known reserved names (id, split, age), Standard Column names, or other.</li>
<li>The number of datasets where the particular column is included.</li>
<li>Any special treatment of that particular column. This can include:
<ul>
<li>treated as a reserved column name (unselectable- automatically used)</li>
<li>one hot encoding was applied (default for standard columns marked as ‘categorical’ type)</li>
<li>information on whether or not columns present in a selected model archetecture are present in provided datasets.</li>
</ul></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/data_columns_lots_o_details.png" class="img-fluid figure-img"></p>
<figcaption>Information in Data Columns</figcaption>
</figure>
</div>
<details>
<summary>
Training Mode
</summary>
<p>The data pane will provide the above information, and should be fairly self explanatory. Data that are unselected will not be used to train the model. You may choose to unselect or retain partial matches between the different selected datasetes. Sometimes, it may help to remove partial matches for more consistent model performance between different datasets, whereas conversely it may help optimize for performance to leave certain partially available columns in.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/training_data_pane.png" class="img-fluid figure-img"></p>
<figcaption>Examples of information feedback from Data Pane from selections; training mode</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Inference Mode
</summary>
<p>When a trained model is selected, and there are differences between the data columns used to train the model and the data columns available in the selected dataset, the application will unselect the data columns as an option without options to reselect, and state why. This could be either that:</p>
<ul>
<li>the column is <strong>included in pretrained model</strong> (but absent from dataset)</li>
<li>the column is <strong>not used in pretrained model</strong> (but present in dataset)</li>
</ul>
<p>For data columns that are present in both the dataset(s) and pretrained model, it will be optional to include them. When the data are fully available, you would usually elect to include available data that match the trained model. In cases where the selected datasets partially match what the model has available, you may prefer to remove a partially available column to allow for more equal treament by the model among the datasets. You can also choose to unselect certain data for experimental reasons (for example, to simulate the effect of a potentially absent data column in the future).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/inference_mode_data_pane.png" class="img-fluid figure-img"></p>
<figcaption>Examples of information feedback from Data Pane from selections; inference mode</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Fine-tuning Mode
</summary>
<p>For the fine-tuning mode, the Data Column section is a mix of the behaviors of training and inference. The model archetectures on first training are hardcoded (<strong><em>NOTE: for now</em></strong>) to provide a maximum of 100 biological/geospatial/temporal features for future trainings, allowing the same weights to be preserved while being flexible to dynamic data availability. This means that datasets that are now available for retraining will be possible to include even if not present in the original model. The Data Column pane will flag standard columns which, like in inference, are either present on the model archetecture and absent in the data (<strong>included in pretrained model</strong>), but will also provide this message when columns in the dataset are included in the pretrained model to help distinguish and clarify decisions when it comes to choosing to include/exlude new data or data already present in the model during retraining.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/fine_tuning_data_pane.png" class="img-fluid figure-img"></p>
<figcaption>Examples of information feedback from Data Pane from selections; fine-tuning mode</figcaption>
</figure>
</div>
</details>
<p>Both inference and fine-tuning will flag if a column was NULLIFIED in the last training event, meaning, the biological/geospatial/temporal data was named and included some point in the model training, but in the latest round was given a dummy value to deprioritize it for retraining. For inference, a column currently nullified shouldn’t be used except for experimental reasons. NULLIFIED columns can be added back in as desired for fine-tuning, but care should be taken when reintroducing it as performance impacts can be unpredictable.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/nullified.png" class="img-fluid figure-img"></p>
<figcaption>Data Pane showing columns that were nullifed in last retraining</figcaption>
</figure>
</div>
</details>
<details>
<summary>
<font size="4">Select Parameters</font>
</summary>
<p>The Select Parameters section allows you to define relevant parameters for the model run event. This is broken down into three component sections: signal processing parameters, mode parameters, and approach parameters. Some number of these are applicable for each mode, and the way each component section is interfaced with changes depending on the selected mode.</p>
<details>
<summary>
Signal processing parameters
</summary>
<p>This section is where signal processing algorithms are selected. These can only be changed in a new training event.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/parameters_signal_processing1.png" class="img-fluid figure-img"></p>
<figcaption>Signal processing options during training</figcaption>
</figure>
</div>
<p>Interpolation can be set to custom bounds to promote interoperability in future use, otherwise it will default to the minimum and maximum values present in the training dataset.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/parameters_signal_processing2.png" class="img-fluid figure-img"></p>
<figcaption>Signal processing options during training; custom interpoloation</figcaption>
</figure>
</div>
<p>During inference or retraining, this section shows the preset parameters which will be applied to the model run but are unchangeable. If the wav numbers have different attributes (start, end, step), 1d interpolation will be applied to attempt to make the signal compatible.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/parameters_signal_processing3.png" class="img-fluid figure-img"></p>
<figcaption>Fixed signal processing choices for inference and retraining</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Mode parameters
</summary>
<p>Mode parameters are generic to a specific mode: training, inference, or fine-tuning. Training options include a seed (to help ensure reproduceable initial random weights), custom defined splits, number of epochs, and early stopping parameters (<strong>note that manual early stopping is not currently supported</strong>).</p>
<p>Currently, there are no parameters specific to inference.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/parameters_signal_mode_training.png" class="img-fluid figure-img"></p>
<figcaption>Parameters for training/fine-tuning modes</figcaption>
</figure>
</div>
</details>
<details>
<summary>
Approach parameters
</summary>
<p>Mode parameters are generic to a specific training approach. Approaches are meant to expand and vary to cover different resonable scientific approaches to model training. The parameters vary depending on the approach, and when developing new approaches, you can define these using a special data structure in the ML codebase to avoid having to develop the front end code to encorporate them (TRAINING APPROACHES variable in the <a href="https://github.com/noaa-afsc/ftnirs-ml-codebase/blob/main/ftnirsml/constants.py">“constants”</a> file within the ML codebase)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/parameters_signal_approach.png" class="img-fluid figure-img"></p>
<figcaption>Parameters for training/fine tuning approaches</figcaption>
</figure>
</div>
</details>
</details>
<details>
<summary>
<font size="4">Stats and graphical artifacts</font>
</summary>
<p>After a model run event, some performance feedback will be provided back in form of stats and graphical artifacts. What you get varies on a few conditions:</p>
<p>Training/fine tuning: you will get back performance stats grouped down by split. The performance stats will include n, r2, loss, mse (mean square error) and mae (mean average error). Generally r2 is your most informative feedback, and differences in r2 between the different splits can be used to quickly assess whether underfitting or overfitting has taken place (along with the training graph to the right of the run button). These modes will always produce a scatterplot of true age values vs.&nbsp;predicted values, allowing for more detailed information on performance bias and variance across the age range.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_training_stats.png" class="img-fluid figure-img"></p>
<figcaption>Training/fine-tuning, by split</figcaption>
</figure>
</div>
<p>Inference: If truth ages are provided when inference is run, inference will produce performance stats just like in training/fine-tuning. the data will now be grouped by component dataset, as split is not used during inference. (<strong><em>NOTE to self: should probably have stats breakdown at dataset level as well in this case?</em></strong>)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_inf_truth_ages.png.png" class="img-fluid figure-img"></p>
<figcaption>Inference, with truth ages</figcaption>
</figure>
</div>
<p>If not, it will produce a histogram of ages (<strong><em>NOTE to self: in unaged case, should probably still be grouped by dataset?</em></strong>).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_predicted_ages.png" class="img-fluid figure-img"></p>
<figcaption>Inference, no truth ages</figcaption>
</figure>
</div>
<p>If you have some ages provided and some ages missing in your training dataset, you will get both graphics.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_inf_truth_ages_some_missing.png" class="img-fluid figure-img"></p>
<figcaption>Inference, mixed availability of ages</figcaption>
</figure>
</div>
<p><strong>Graphical outputs need to be downloaded individually as needed: they are not retained in the bundle of downloaded artifacts, although the information is there to recreate them as needed</strong>. Click in the top right option on any interactive figure to download it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/app_screenshot_figure_save.png" class="img-fluid figure-img"></p>
<figcaption>Interactive figure with download option</figcaption>
</figure>
</div>
<p>Statistical outputs are available as part of the standard downloaded results. All figures and stats can be recreated with downloaded datasets.</p>
</details>
<details>
<summary>
<font size="4">Download Results</font>
</summary>
<p>The download results option will download to your local PC a bundle of files that are useful for quantifying performance, supporting more sophisticated downstream analysis, using the trained model outside of the application, and tracking versioning.</p>
<p>When you download the data, it will save a bundle of file within a tar.gz format file.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/file_download.png" class="img-fluid figure-img"></p>
<figcaption>Downloaded data and results</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/outputs_unpacked.png" class="img-fluid figure-img"></p>
<figcaption>Contents</figcaption>
</figure>
</div>
<p>You can use a tool like winzip or 7zip to unpack it locally as a directory. The included files are:</p>
<ul>
<li>stats.csv: the model run stats.</li>
<li>[model_name].keras.zip: this is the model object with bundled metadata which is interoperable withe the apcation and ML codebase. The [model_name].keras.zip object can be further unpacked to extract the keras model and metadata, but the .zip file itself is used by both of these tools as the standard formatted model object. (see more information on working with this format in the ML codebase section <strong><em>LINK</em></strong>). This will match the name provided by you in the app, if provided, otherwise it will be ‘unnamed.keras.zip’.</li>
<li>ml_formatted_data_plus_untransformed_ages.csv: this is a dataset which includes the data as formatted prior to the model run event. It also includes untransformed ages. This allows you to understand the actual dataset that the model was trained on (includes formatting / post processing like, one hot encoding, applied scalers, interpolation, etc). This table also contains hashes to uniquely identify different component datasets, to allow for tracking assumptions of data used over time. This is the primary data object that should allow you to better understand the model behavior via the formatted dataset, do more sophisticated analysis of prediction performance downstream, and troubleshoot unexpected or undesireable behaviors.</li>
<li>config.yml: this contains parameter selections for the model run event.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../content/images/dataset_output_ex.png" class="img-fluid figure-img"></p>
<figcaption>Output dataset for downstream analysis</figcaption>
</figure>
</div>


</details></section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/noaa-afsc\.github\.io\/ftnirs-ml-application\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../content/Use.html" class="pagination-link" aria-label="Use">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Use</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../content/useCodebase.html" class="pagination-link" aria-label="The codebase">
        <span class="nav-page-text">The codebase</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© CC-1.0</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/edit/main/content/useApp.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/blob/main/content/useApp.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/noaa-afsc/ftnirs-ml-application/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>